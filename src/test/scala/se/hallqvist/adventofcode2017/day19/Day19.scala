package se.hallqvist.adventofcode2017.day19

import org.scalatest._

/*
--- Day 19: A Series of Tubes ---

Somehow, a network packet got lost and ended up here. It's trying to follow a routing diagram (your puzzle input), but it's confused about where to go.

Its starting point is just off the top of the diagram. Lines (drawn with |, -, and +) show the path it needs to take, starting by going down onto the only line connected to the top of the diagram. It needs to follow this path until it reaches the end (located somewhere within the diagram) and stop there.

Sometimes, the lines cross over each other; in these cases, it needs to continue going the same direction, and only turn left or right when there's no other option. In addition, someone has left letters on the line; these also don't change its direction, but it can use them to keep track of where it's been. For example:

     |          
     |  +--+    
     A  |  C    
 F---|----E|--+ 
     |  |  |  D 
     +B-+  +--+ 

Given this diagram, the packet needs to take the following path:

Starting at the only line touching the top of the diagram, it must go down, pass through A, and continue onward to the first +.
Travel right, up, and right, passing through B in the process.
Continue down (collecting C), right, and up (collecting D).
Finally, go all the way left through E and stopping at F.
Following the path to the end, the letters it sees on its path are ABCDEF.

The little packet looks up at you, hoping you can help it find the way. What letters will it see (in the order it would see them) if it follows the path? (The routing diagram is very wide; make sure you view it without line wrapping.)

--- Part Two ---
The packet is curious how many steps it needs to go.

For example, using the same routing diagram from the example above...

     |          
     |  +--+    
     A  |  C    
 F---|--|-E---+ 
     |  |  |  D 
     +B-+  +--+ 

...the packet would go:

6 steps down (including the first line at the top of the diagram).
3 steps right.
4 steps up.
3 steps right.
4 steps down.
3 steps right.
2 steps up.
13 steps left (including the F it stops on).
This would result in a total of 38 steps.

How many steps does the packet need to go?

*/

class Day19 extends FlatSpec {
  val input = """
                                                                           |                                                                                                                             
     +-+         +---+   +---+   +-----------------------------------------|---+                                             +---+ +-------------------------------------+         +-------------------+ 
     | |         |   |   |   |   |                                         |   |                                             |   | |                                     |         |                   | 
 +-------------------|-------|-------------+                           +---|-------------------------------+                 |   +---------------------------------+     |         |                   | 
 |   | |         |   |   |   |   |         |                           |   |   |                           |                 |     |                               |     |         |                   | 
 |   | |         |   +---|---|---|---------|---------------------+     |   |   |                           |                 |     |   +---+                       |     |         |                   | 
 D   | |         |       |   |   |         |                     |     |   |   |                           |                 |     |   |   |                       |     |         |                   | 
 |   | |         |   +---|---+   |     +---|-------------+       |   +-+ +-|---|---------------------------|---------------------+ |   |   |                       |     |         |     +---------+   | 
 |   | |         |   |   |       |     |   |             |       |   |   | |   |                           |                 |   | |   |   |                       |     |         |     |         |   | 
 |   +-|---------|---|-------+   |     |   |             |       |   |   | |   |                           |                 |   | |   |   |                       |     |         |     |         |   | 
 |     |         |   |   |   |   |     |   |             |       |   |   | |   |                           |                 |   | |   |   |                       |     |         |     |         |   | 
 |   +-|---------|---------------|-----|---|---------------------|---|-----|---|--------------------F------------------------------+   +-----------------+         |     |         |     |         |   | 
 |   | |         |   |   |   |   |     |   |             |       |   |   | |   |                           |                 |   |         |             |         |     |         |     |         |   | 
 |   +-|-----+   |   | +-|---|---|-----|---|---------------------|-------|---------------------------------------------+     |   |         |             |         |     |         |   +-+ +---------+ | 
 |     |     |   |   | | |   |   |     |   |             |       |   |   | |   |                           |           |     |   |         |             |         |     |         |   |   |       | | | 
 |     |     |   |   | | |   |   |   +-|-------------------------|---------+   |       +-------------------|-----------|-----|---+       +-------------+ +-+       |     | +-----------+   |       | | | 
 |     |     |   |   | | |   |   |   | |   |             |       |   |   |     |       |                   |           |     |           | |           |   |       |     | |       |       |       | | | 
 |     |     |   |   | | |   +---|---|-----|-----------------------------+     |       |                   |           |     |           | |         +-|---|-+     |     | |       |       |       | | | 
 |     |     |   |   | | |       |   | |   |             |       |   |         |       |                   |           |     |           | |         | |   | |     |     | |       |       |       | | | 
 |     |     | +-------|-|-------|---|-|---|-------------|-----------|---------|---------------------------|---------+ |     +---+       | |         | |   | |     |     | |       |       |       | | | 
 |     |     | | |   | | |       |   | |   |             |       |   |         |       |                   |         | |         |       | |         | |   | |     |     | |       |       |       | | | 
 | +---------|-|-|-------+       |   | |   |             |   +-------|-----------------|-------------------|---------|-|-----------------|-|---------|-|---|-----------------+     |       |       | | | 
 | |   |     | | |   | |         |   | |   |             |   |   |   |         |       |                   |         | |         |       | |         | |   | |     |     | | |     |       |       | | | 
 | |   |     | | |   | +---------------|-----------------------+ |   |         |       |                   |         | |         |       | |         +-|---|-|-----------|-|-------|-------|---------|-+ 
 | |   |     | | |   |           |   | |   |             |   | | |   |         |       |                   |         | |         |       | |           |   | |     |     | | |     |       |       | |   
 | |   +-----+ | |   |     +-----------|-----------------|---|-|-----------------------|-----------------------------|-------------------|-------------|-------------------|-------|-----+ |       | +-+ 
 | |           | |   |     |     |   | |   |             |   | | |   |         |       |                   |         | |         |       | |           |   | |     |     | | |     |     | |       |   | 
 | |           | |   |   +-----------------------------------|-|---+ +-+ +-----|---------------------------|-----------|-----------------|-|-----------------------------|-|-|-----------|-|-------|-+ | 
 | |           | |   |   | |     |   | |   |             |   | | | |   | |     |       |                   |         | |         |       | |           |   | |     |     | | |     |     | |       | | | 
 | |           | |   |   | |     |   | |   |             |   | | | |   | |     |       |                   |         | |         |       | |       +-+ |   | |     |     | | |     |     | |       | | | 
 | |           | |   |   | |     |   | |   |             |   | | | |   | |     |       |                   |         | |         |       | |       | | |   | |     |     | | |     |     | |       | | | 
 | |           | |   |   | |     | +-|-------------------------|-|-------+     |       |                   |         | |         |       | |       | | |   | |     |     | | |     |     | |       | | | 
 | |           | |   |   | |     | | | |   |             |   | | | |   |       |       |                   |         | |         |       | |       | | |   | |     |     | | |     |     | |       | | | 
 | |           | |   |   | |     | | | |   |             |   | | | |   |       |       |                   |         | |         |       | +-------|-|-|-----------|-----|-+ |     |     | |       | | | 
 | |           | |   |   | |     | | | |   |             |   | | | |   |       |       |                   |         | |         |       |         | | |   | |     |     |   |     |     | |       | | | 
 | |   +-+     | |   |   +-----+ | +---|---|-----------------|-|---|---|-------|-------|-------------------|---------------------------+ |         | | |   | |     |     |   |     |     | |       | | | 
 | |   | |     | |   |     |   | |   | |   |             |   | | | |   |       |       |                   |         | |         |     | |         | | |   | |     |     |   |     |     | |       | | | 
 | |   | |     | |   |     |   | |   | |   |             |   | | | |   |       |       | +-----------------------+   | |     +---------|-----------|---------+     |     |   |     | +---|---------+ | | 
 | |   | |     | |   |     |   | |   | |   |             |   | | | |   |       |       | |                 |     |   | |     |   |     | |         | | |   J       |     |   |     | |   | |         | | 
 | +---|-|-----|-------+   |   | |   | |   |             | +-+ | | |   |       |       | |               +-|-----------|---------------|---------------|-----------------------------|-------+       | | 
 |     | |     | |   | |   |   | |   | |   |             | |   | | |   |       |       | |               | |     |   | |     |   |     | |         | | |   |       |     |   |     | |   | | |       | | 
 |     | |     | |   | |   |   | |   | |   |             | |   | | |   +-------|-------------------------+ |     |   | |     |   |     | |         | | |   |       |     |   | +---+ +-----|-|-----+ | | 
 |     | |     | |   | |   |   | |   | |   |             | |   | | |           |       | |                 |     |   | |     |   |     | |         | | |   |       |     |   | |         | | |     | | | 
 |     | |     | |   | |   |   | |   | |   |           +---|---+ +---------------------------------+       +-----|---|-------|---|-------------------|-|---|-----+ |     |   | |         | | |     | | | 
 |     | |     | |   | |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |     | |         | | |   |     | |     |   | |         | | |     | | | 
 | +---|-------|-|---|-|-------|-------|---|-----------------------|-------------------|-----------|-----------------|-----------------|---------------|---|-----------------|-----------+ | |     | | | 
 | |   | |     | |   | |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |     | |         | | |   |     | |     |   | |           | |     | | | 
 | |   | |     | |   | |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |     | |         | +-------------|-----|-------------------|-----+ | | 
 | |   | |     | |   | |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |     | |         |   |   |     | |     |   | |           | |       | | 
 | |   | |     | |   | |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |     | |         |   |   |     | +-----|---|-|-----------|-+       | | 
 | |   | |     | |   | |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |     | |         |   |   |     |       |   | |           |         | | 
 | |   | |     | |   +---------------|-|-------------------|-------------------|-------|-|-----------------------------------|---|---+ | |       +-|---------------------|---|-+           |         | | 
 | |   | |     | |     |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |   | | |       | |   |   |     |       |   |             |         | | 
 | |   | |     | |   +---+ |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |   | | |     +-|-|---|---|-----|-------|---|-------------+         | | 
 | |   | |     | |   | | | |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |   | | |     | | |   |   |     |       |   |                       | | 
 | | +-|---------|---|---------+ |   | |   | +---------|-----------|-------------------|-|-----------------------|-----------|-------|-|-------|---|-------|-------+     |   |                       | | 
 | | | | |     | |   | | | |     |   | |   | |         | | |       |           |       | |         |             |   | |     |   |   | | |     | | |   |   |     | |     |   |                       | | 
 | | | | |     | |   | | | |     +---------|-|-------------+       |           |       | |         |             |   | |     |   |   | | |     | | |   |   |     | |     |   |                       | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |     |   |   | | |     | | |   |   |     | |     |   |                       | | 
 | | +---------|---------------------|-------------------|---------|-----------|-------|-|---------|-------------------|-----|---+   +---|-----|-|-|-+ +-------+ | |     |   |                       | | 
 | |   | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |     |         | |     | | | |     |   | | |     |   |                       | | 
 | | +---------|-|-------|-|-----------------|-----------|---------|---------------------------------------------|-----------|-----------|-----+ | | |   +-|-+ | | |     |   |                       | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |     |         | |       | | |   | | | | | |     |   |                       | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |   +-------------|-----+ | | |   | | | | | |     |   |                       | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |   | |         | |     | | | |   | | | | | |     |   |                       | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |   | |         | |     | | | |   | | | | | |     |   |   +---------------+   | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |   | |         | |     | | | |   | | | | | |     |   |   |               |   | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |   +-|-----+   +-------|-|-|-|-----|-----|-------|---|---------------------+ | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |     |     |     |     | | | |   | | | | | |     |   |   |               | | | | 
 | | | | |     | |   | | | |         | |   | |         | |         |     +-------------|-|---------------------------|-|-----|-----|-----|-----+ | | |   | +-|-+ | |     |   |   |               | | | | 
 | | | | |     | |   | | | |         | |   | |         | |         |     |     |       | |         |             |   | |     |     |     |       | | |   |   |   | |     |   |   |               | | | | 
 | | | | |     | |   | | | |         | |   | |         | | +-------|-------------------|-|-----------------------|---|-|-----|-------------------|-------|-------------------|---|---------------+ | | | 
 | | | | |     | |   | | | |         | |   | |         | | |       |     |     |       | |         |             |   | |     |     |     |       | | |   |   |   | |     |   |   |                 | | | 
 | | | | |     | |   | | | |         | |   | |         | | |       |     |     |       | |         |             |   | |     |     |     |       | | |   |   |   | |     |   |   |                 | | | 
 | | | | |     | |   | | | |         | |   | |         | | |       |     |     |       | |         |             |   | |     |     |     |       | | |   |   |   | |     |   |   |                 | | | 
 | | | | |     | |   | | | |         | |   | |         | | |       |   +---------------|-------------------------|---|-|-----|-----------|-------|-|-|-+ |   |   | |     |   |   |                 | | | 
 | | | | |     | |   | | | |         | |   | |         | | |       |   | |     |       | |         |             |   | |     |     |     |       | | | | |   |   | |     |   |   |                 | | | 
 | +-|---|-----------|-|---|-----------|---|-|-----------|-|-------|-----|-----|-------|-|---------|-----------------|-|-----|-----|-------------|-----------|---|-------|-+ |   |       +---------+ | | 
 |   | | |     | |   | | | |         | |   | |         | | |       |   | |     |       | |         |             |   | |     |     |     |       | | | | |   |   | |     | | |   |       |           | | 
 |   | | |     | |   | | | |         | |   | |   +-----|-------------------------------|-|---------+             |   | |     |     |     |       | | | | |   |   | |     | | |   |       |           | | 
 |   | | |     | |   | | | |         | |   | |   |     | | |       |   | |     |       | |                       |   | |     |     |     |       | | | | |   |   | |     | | |   |       |           | | 
 |   | | |     | |   | | | |         | |   | |   |     | | |       |   | +-------------|-------------------------|-----|-----|-----|---------------|-|-|-|---|---|-------|---|---|-----------+       | | 
 |   | | |     | |   | | | |         | |   | |   |     | | |       |   |       |       | |                       |   | |     |     |     |       | | | | |   |   | |     | | |   |       |   |       | | 
 |   +-|-------|-|---|---|-----------+ |   | |   |     | | |       |   |       |       | |                       |   | |     |     |     |       | | | | |   |   | |     | | |   |       |   |       | | 
 |     | |     | |   | | | |           |   | |   |     | | |       |   |       |       | |                       |   | |     |     |     |       | | | | |   |   | |     | | |   |       |   |       | | 
 |     | |     | |   | | | |     +-----|---|-----------|-|---------|---|-------|---------------------------------|-----|-------------------------|-|-|-|-|---|---|---------|-----|-----------|-----+ | | 
 |     | |     | |   | | | |     |     |   | |   |     | | |       |   |       |       | |                       |   | |     |     |     |       | | | | |   |   | |     | | |   |       |   |     | | | 
 +-----|-|-----|-----------------------|-----|---|-----|-|-|-------------------|-------|-------------------------|---|-|-----------|-----|---+   | | | | |   |   | |     | | |   |       |   |     | | | 
       | |     | |   | | | |     |     |   | |   |     | | |       |   |       |       | |                       |   | |     |     |     |   |   | | | | |   |   | |     | | |   |       |   |     | | | 
       | |     | |   | | | |     |     |   | |   |     | | |       |   |       |       | |             +---------|---|-|-+   |     |     |   |   | | | | |   |   | |     | | |   |       |   |     | | | 
       | |     | |   | | | |     |     |   | |   |     | | |       |   |       |       | |             |         |   | | |   |     |     |   |   | | | | |   |   | |     | | |   |       |   |     | | | 
     +---|-----------|-|-|-------|---+ |   | |   +-------|-+       |   |       |       | |             |         |   | | |   |     |     |   | +---|-|---|---|---|-----+ | | |   |       |   |     | | | 
     | | |     | |   | | | |     |   | |   | |         | |         |   |       |       | |             |         |   | | |   |     |     |   | | | | | | |   |   | |   | | | |   |       |   |     | | | 
     | | |     | |   | | | |     |   | |   | |         | |         |   |       |       | |             |         |   | | |   |     |     |   | | | | | | |   |   | |   | | | |   |       |   |     | | | 
     | | |     | |   | | | |     |   | |   | |         | |         |   |       |       | |             |         |   | | |   |     |     |   | | | | | | |   |   | |   | | | |   |       |   |     | | | 
 +---+ | |     | |   | | | |     |   +-+   | |         | |         |   |       |       | |             |         |   | | |   |     |     |   | | | | | | |   |   | |   | | | |   |       |   |     | | | 
 |     | |     | |   | | | |     |         | |         | |         |   |       |       | |             |         |   | | |   |     |     |   | | | | | | |   |   | |   | | | |   |       |   |     | | | 
 | +---+ |   +-|-----|---|-|-----|---------------------|-|---------------------|---------|-----------------------|---|-------|-----------|-------|-|---------|-----------|-------|-------+   |     | | | 
 | |     |   | | |   | | | |     |         | |         | |         |   |       |       | |             |         |   | | |   |     |     |   | | | | | | |   |   | |   | | | |   |           |     | | | 
 | | +---|-----|-|-------|-|---------------|-|-----------|---------+   |       +-------|-|-------------|-------------|-------|-----|-----|-+ | | | | | | |   |   | |   | | | |   |           |     | | | 
 | | |   |   | | |   | | | |     |         | |         | |             |               | |             |         |   | | |   |     |     | | | | | | | | |   |   | |   | | | |   |           |     | | | 
 | | +-----------|---+ | | |     |         | |         | |             |               | |           +-|---------|---|-------|-----|-----|-|---|-|-|---|-------------------|-|-------------+ |     | | | 
 | |     |   | | |     | | |     |         | |         | |             |               | |           | |         |   | | |   |     |     | | | | | | | | |   |   | |   | | | |   |         | |     | | | 
 | |     |   | | |     | | |     |         | |         | |             |               | |           | |         |   | | |   |     |     | | | | | | | | |   |   | |   | | | |   |         | |     | | | 
 | |     |   | | |     | | |     |         | |         | |             |               | |           | |         |   | | |   |     |     | | | | | | | | |   |   | |   | | | |   |         | |     | | | 
 | |     |   | | |     | +-------|---------|-------------|-----------------------------|---------------|---------------------|-----------|-|-|-|-|-|-|-----------|-|-----|-----------+     +-|-+   | | | 
 | |     |   | | |     |   |     |         | |         | |             |               | |           | |         |   | | |   |     |     | | | | | | | | |   |   | |   | | | |   |   |       | |   | | | 
 | |     |   | | |     |   | +---|---------------------|-|-------------|---------------+ +-----------|-----------|---|-|-|---|-----|---------|-|-|-|-|-|---------------+ | | |   |   |       | |   | | | 
 | |     |   | | |     |   | |   |         | |         | |             |                             | |         |   | | |   |     |     | | | | | | | | |   |   | |     | | |   |   |       | |   | | | 
 +-|-----|-----|-----------|---------------|-|---------|-|-------------|---------+       +-----------|-|---------|-----|-|---------|-----|-|---|-------|-|-----------------|-----|-----------|-|-+ | | | 
   |     |   | | |     |   | |   |         | |         | |             |         |       |           | |         |   | | |   |     |     | | | | | | | | |   |   | |     | | |   |   |       | | | | | | 
   |     |   | | |     |   | |   |   +-------|---------|-|-------------|-----------------------------|---+       |   +-|-|---------------|-----|-------|-|---+   | |     | | |   |   |       | | | | | | 
   |     |   | | |     |   | |   |   |     | |         | |             |         |       |           | | |       |     | |   |     |     | | | | | | | | |       | |     | | |   |   |       | | | | | | 
   |     | +-|-----+   |   | |   |   |     | |         | |         +---|-----------------------------|-----------------|-|---------------|---------------------+ | |     | | |   |   |       | | +-+ | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |   |         |       |           | | |       |     | |   |     |     | | | | | | | | |     | | |     | | |   |   |       | |     | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |   |         |       |           | | |       |     | |   |     |     | | | | | | | | |     | | |     | | |   |   |     +-----+   | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |   |         |       |           | | |       |     | |   |     |     | | | | | | | | |     | | |     | | |   |   |     | | | |   | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |   |         |       |           | | |       |     +-|---------|-----+ | | | | | | | |     | | |     | | |   |   |     | | | |   | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |   |         |       |           | | |       |       |   |     |       | | | | | | | |     | | |     | | |   |   |     | | | |   | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |   +-----------+     |           | | |       |       |   |     |       | | | | | | | |     | | |     +-|-------+ |     | | | |   | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |             | |     |           | | |       |       |   |     |       | | | | | | | |     | | |       | |   | | |     | | | |   | | 
   |     | | | | | |   |   | +---+   |     | |         | |         |             | |     |           | | |       |       |   |     |       | | | | | | | |     | | |       | |   | | |     | | | |   | | 
   |     | | | | | |   |   |         |     | |         | |         |             | |     |           | | |       |       |   |     |       | | | | | | | |     | | |       | |   | | |     | | | |   | | 
   |     | | | | | |   |   |         |     | |         | | +-------|-------------|--------------O----|-|---------------------------|-------|-|---|-|-|-------+ | | |       | |   | | |     | | | |   | | 
   |     | | | | | |   |   |         |     | |         | | |       |             | |     |           | | |       |       |   |     |       | | | | | | | |   | | | |       | |   | | |     | | | |   | | 
   |     | | | | | |   |   |         |     | |         | | |       |             | |     |           | +-|-+     |       |   |     |       | +-----|-------+ | | | |       | |   | | |     | | | |   | | 
   |     | | | | | |   |   |         |     | |         | | |       |             | |     |           |   | |     |       |   |     |       |   | | | | | | | | | | |       | |   | | |     | | | |   | | 
   |     | | | | +-|-----------------------|---------+ | | |       |             | |     |           |   | |     |       |   |     |       |   | | | | | | | | | | |       | |   | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |       | | | |       |             | |     |           |   | |     |       |   |     |       |   | | | | | | | | | | |       | |   | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |       +---|-------------------------------+           |   | +-----|-----------|-----------------|-----|-+ | | | | | |       | |   | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |         | | |       |             | |                 |   |       |       |   |     |       |   | | | |   | | | | | |       | |   | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |         | | |       |             | |             +---|-------------------------------------|---|-----|---|---|-|-|-----------+   | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |         | | |       |             | |             |   |   |       |       |   |     |       |   | | | |   | | | | | |       |     | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |         | | |       |             | |             |   |   |       |       |   |     |       |   | | | |   | | | | | |       |     | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |         | | |       |             | |             |   |   |       |       |   |     |       |   | | | |   | | | | | |       |     | | |     | | | |   | | 
   |     | | | |   |   |   |     +-----------|---------|---|-------|-------------|---------------|---|---|-------|-------|---------|-----------|-|---|---|-|-|-+ | |       |     | +-|-----------|-+ | | 
   |     | | | |   |   |   |     |   |     | |         | | |       |             | |             |   |   |       |       |   |     |       |   | | | |   | | |   | |       |     |   |     | | | | | | | 
   |     | | | |   |   |   |     |   |     | |       +-|-------------------------|---------------|-------|---------------|-------+ |       |   | | | |   | | |   | |       |     |   |     | | | | | | | 
   |     | | | |   |   |   |     |   |     | |       | | | |       |             | |             |   |   |       |       |   |   | |       |   | | | |   | | |   | |       |     |   |     | | | | | | | 
   |     | | +---------|---------|---------|-+       | | | |       |           +-|-------------------|-----------|-------|-------|-|-------|---|---|-|---|---|---+ |       |     |   |     | | | | | | | 
   |     | |   |   |   |   U     |   |     |         | | | |       |           | | |             |   |   |       |       |   |   | |       |   | | | |   | | |     |       |     |   |     | | | | | | | 
 +-|---+ | | +---------|---|---------|-------+       | | | |       |           | | |   +-----------+ +---|---------------------------------|-----|-----------------|-----------------|-----------|-+ | | 
 | |   | | | | |   |   |   |     |   |     | |       | | | |       |           | | |   |         | |     |       |       |   |   | |       |   | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | | |   |   |   |     |   |     | |       | | +-|-------|-------------|-|---+         | |     |       |       |   |   | |       |   | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | | |   |   |   |     |   |     | |       | |   |       |           | | |             | |     |       |       |   |   | |       |   | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | | | +-------------------|-----|-|-------|-|---|-------------------|-|---------------|-|---------------------|---|-------------+   | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | | | | |   |   |     |   |     | |       | |   |       |           | | |             | |     |       |       |   |   | |           | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | | | | |   |   |     |   |     | |       | |   |       |           | | |   +-----------|---------+   |       |   |   | |           | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | | | | |   |   |     |   |     | |       | |   |       |           | | |   |         | |     |   |   |       |   |   | |           | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | +-|-|-|-------|-----|---+ +---|-+   +---|-----|-----------------------|---|-------------------------|-----------|---|-|-----------|-|-------|-+ |     |       |     |   |     | | | |   | | 
 | |   | | |   | | |   |   |     |     |   |     |   | |   |       |           | | |   |         | |     |   |   |       |   |   | |           | | | |   |   |     |       |     |   |     | | | |   | | 
 | |   | | |   | | |   |   |     +---+ |   |     |   +-|-----------|-------------|---------------|-|-------------|---------------|-----------+ | | +-+   | +-------|-------------+   |     | | | |   | | 
 | |   | | |   | | |   |   |         | |   |     |     |   |       |           | | |   |         | |     |   |   |       |   |   | |         | | |       | | |     |       |         |     | | | |   | | 
 +-|-----|-|---|-----------|---------|-|---|-----------|---|-------|-------------|---------------|-----+ |   |   |       | +-|-+ | |         | | |       | | |     |       |         |     | | | |   | | 
   |   | | |   | | |   |   |         | |   |     |     |   |       |           | | |   |         | |   | |   |   |       | | | | | |         | | |       | | |     |       |         |     | | | |   | | 
   | +-----|-------|---|---|-----+   | |   |     |   +-|---|---------------------------|-----------+   | |   |   |       | | | | | |         | | |       | | |     |       |         |     | | | |   | | 
   | | | | |   | | |   |   |     |   | |   |     |   | |   |       |           | | |   |         |     | |   |   |       | | | | | |         | | |       | | |     |       |         |     | | | |   | | 
   | | | | |   | | +-------|-----|-----|---|---------|-------------|-----------|-|-|---|---------|-----|---------|---------+ | | | |         | | |       | | +-----------------------------+ | | |   | | 
   | | | | |   | |     |   |     |   | |   |     |   | |   |       |           | | |   |         |     | |   |   |       |   | | | |         | | |       | |       |       |         |       | | |   | | 
   | | | | |   | |     +---|---------|-----|---------+ | +-|--------------T------|-|---|---------|-----+ +-------|-----------|---|-----------|-----------|-+       |       |         |       | | |   | | 
   | | | | |   | |         |     |   | |   |     |     | | |       |           | | |   |         |           |   |       |   | | | |         | | |       |         |       |         |       | | |   | | 
 +-|---|-------|-----------|---------|-----------------|-----------|---------------|---|-------------------------|-------|-----|---|-----------+ |       |         |       |         |       | | |   | | 
 | | | | | |   | |         |     |   | |   |     |     | | |       |           | | |   |         |           |   |       |   | | | |         |   |       |         |       |         |       | | |   | | 
 | | | | | |   | |         |     |   | |   |     |     | | |       |           +-|-|-------------|-----+     +---|-------+ +-+ | | | +-------|-----------|---------|-------|---------|---------|-+   | | 
 | | | | | |   | |         |     |   | |   |     |     | | |       |             | |   |         |     |         |         |   | | | |       |   |       |         |       |         |       | |     | | 
 | | | | | |   | |         |     |   | |   |     |     | | |       |             | |   |         |     |         |         |   | | | |       |   |       |         |       |         |       | |     | | 
 | | | | | |   | |         |     |   | |   |     |     | | |       |             | |   |         |     |         |         |   | | | |       |   |       |         |       |         |       | |     | | 
 +---------+   | |         |     |   | |   |     |     | | |       |             | |   |         |     |         | +-----------|-------------|-+ |       | +-------|-------|-------------------------|-+ 
   | | | |     | |         |     |   | |   |     |     | | |       |             | |   |         |     |         | |       |   | | | |       | | |       | |       |       |         |       | |     |   
 +-+ | | |     | |         |     |   | |   |     |     | | |       |             | |   |         |     |         +---------|---|---|---------|-|-|-----------------------+ |         +-------|-+     +-+ 
 |   | | |     | |         |     |   | |   |     |     | | |       |             | |   |         |     |           |       |   | | | |       | | |       | |       |     | |                 |         | 
 |   | | |     | |         |     +---+ |   |     |     | +-|---------------------|-|-------------|-----|-----------------------|-----|---------------------|-------+     | |                 |         | 
 |   | | |     | |         |           |   |     |     |   |       |             | |   |         |     |           |       |   | | | |       | | |       | |             | |                 |         | 
 |   | | |     +-|---------|---------------|-----+     |   |       |         +-------------------|-----|-----+     +-------|---|---|-|---------|---------|---------------|-|-+               |         | 
 |   | | |       |         |           |   |           |   |       |         |   | |   |         R     |     |             |   | | | |       | | |       | |             | | |               |         | 
 |   | | |       |         |           |   |     +---------------------------|-----|-------------|-----------|-----------------|-|---|-----------|-------|-----------------|-|---------------|---------+ 
 |   | | |       |         |           |   |     |     |   |       |         |   | |   |         |     |     |             |   | | | |       | | |       | |             | | |               |           
 |   | +-|-------|---------|---------------------------|---|-------|-------------------|---------|-------------------------+   +---|-+   +---|-+ |       | |             | | |               |           
 |   |   |       |         |           |   |     |     |   |       |         |   | |   |         |     |     |                   | |     |   |   |       | |             | | |               |           
 +-------|-------|---------|---------------------------------------|---------|-----|-------------------|-+   |                   | |     |   |   |       | |             | | |               |           
     |   |       |         |           |   |     |     |   |       |         |   | |   |         |     | |   |                   | |     |   |   |       | |             | | |               |           
     |   |       |         |           |   |     |     |   +-------------------------------------------|-+   +-----+             | |     |   |   |       | |             | | |               |           
     |   |       |         |           |   |     |     |           |         |   | |   |         |     |           |             | |     |   |   |       | |             | | |               |           
     |   |       |         |           |   |     |     |           +-----------------------------+     |           +-------+     +-|---+ |   |   |       | |             | | |               |           
     |   |       |         |           |   |     |     |                     |   | |   |               |                   |       |   | |   |   |       | |             | | |               |           
     |   +-------|---------|-----------|---------+ +---|---+                 |   | |   |               +-------+           |       | +-------|---+       | |             | | |               |           
     |           |         |           |   |       |   |   |                 |   | |   |                       |           |       | | | |   |           | |             | | |               |           
 +---------------|-------------------------|-------|---|---|---------------------|-|---+                       +-----------|A------------------------------|-----------+ | | |               |           
 |   |           |         |           |   |       |   |   |                 |   | |                                       |       | | | |   |           | |           | | | |               |           
 |   |           |         |           |   |       |   |   |                 |   | |                                       |       | | | |   |           | |           | | | |               |           
 |   |           |         |           |   |       |   |   |                 |   | |                                       |       | | | |   |           | |           | | | |               |           
 |   |           |       +-|-----------------------+   |   +-----------------|---+ +---------------------------------------+       | | +-+   +-------------------------+ | | |               |           
 |   |           |       | |           |   |           |                     |                                                     | |                   | |             | | |               |           
 +---+   +---+   |       | |       +-------------------|---------------------------------------------------------------------------+ |                   | |             | | |               |           
         |   |   |       | |       |   |   |           |                     |                                                       |                   | |             | | |               |           
 +-----------+   |       | |       |   |   |           |                     +-----------------------------------------+             |                   +-|-------------------------------------------+ 
 |       |       |       | |       |   |   |           |                                                               |             |                     |             | | |               |         | 
 +-+     |       +---------|-------+   |   |           +---------------------------------------------------------------+             +-----------------------------------------------------------------+ 
   |     |               | |           |   |                                                                                                               |             | | |               |           
 Q-+     +---------------+ +-----------+   +---------------------------------------------------------------------------------------------------------------+             +-+ +---------------+           
                                                                                                                                                                                                         
"""

  def part1(s: String) = {
    val grid = s.split("\n").filter(!_.isEmpty)
    val xmax = grid(0).length
    val ymax = grid.size
    var path = ""
    var xy = (grid(0).indexOf('|'), 0)
    val ds = (0, 1)
    val de = (1, 0)
    val dn = (0, -1)
    val dw = (-1, 0)
    def move(xy: (Int, Int), d: (Int, Int)) = (xy._1 + d._1, xy._2 + d._2)
    def valid(xy: (Int, Int)) = xy._1 >= 0 && xy._1 < xmax && xy._2 >= 0 && xy._2 < ymax
    def get(xy: (Int, Int)) = grid(xy._2).charAt(xy._1)
    def canMove(xy: (Int, Int), d: (Int, Int)) = { val nxy = move(xy, d); valid(nxy) && get(nxy) != ' ' }
    var d = ds;
    var stop = false
    while (valid(xy) && get(xy) != ' ') {
      var c = get(xy)
      if (c >= 'A' && c <= 'Z') path += c
      else if (c == '+') {
        val nds = if (d == ds || d == dn) Set(de, dw) else Set(ds, dn)
        d = nds.filter((nd) => canMove(xy, nd)).head
      }
      xy = move(xy, d)
    }
    path
  }

  "part1" should "satisfy the examples given" in {
    assertResult("ABCDEF") { part1("""
     |          
     |  +--+    
     A  |  C    
 F---|----E|--+ 
     |  |  |  D 
     +B-+  +--+ 
""") }
  }
  "part1" should "succeed" in { info(part1(input).toString) }

  def part2(s: String) = {
    val grid = s.split("\n").filter(!_.isEmpty)
    val xmax = grid(0).length
    val ymax = grid.size
    var xy = (grid(0).indexOf('|'), 0)
    val ds = (0, 1)
    val de = (1, 0)
    val dn = (0, -1)
    val dw = (-1, 0)
    def move(xy: (Int, Int), d: (Int, Int)) = (xy._1 + d._1, xy._2 + d._2)
    def valid(xy: (Int, Int)) = xy._1 >= 0 && xy._1 < xmax && xy._2 >= 0 && xy._2 < ymax
    def get(xy: (Int, Int)) = grid(xy._2).charAt(xy._1)
    def canMove(xy: (Int, Int), d: (Int, Int)) = { val nxy = move(xy, d); valid(nxy) && get(nxy) != ' ' }
    var d = ds;
    var stop = false
    var cnt = 0
    while (valid(xy) && get(xy) != ' ') {
      var c = get(xy)
      if (c >= 'A' && c <= 'Z') {}
      else if (c == '+') {
        val nds = if (d == ds || d == dn) Set(de, dw) else Set(ds, dn)
        d = nds.filter((nd) => canMove(xy, nd)).head
      }
      xy = move(xy, d)
      cnt += 1
    }
    cnt
  }

  "part2" should "satisfy the examples given" in {
    assertResult(38) { part2("""
     |          
     |  +--+    
     A  |  C    
 F---|----E|--+ 
     |  |  |  D 
     +B-+  +--+ 
""") }
  }
  "part2" should "succeed" in { info(part2(input).toString) }
}
